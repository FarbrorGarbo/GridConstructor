(this.webpackJsonpgridconstructor=this.webpackJsonpgridconstructor||[]).push([[0],{12:function(t,e,n){},13:function(t,e,n){},14:function(t,e,n){"use strict";n.r(e);var i=n(0),a=n.n(i),r=n(6),s=n.n(r),o=(n(12),n(1)),c=n(4),l=n(2),u=n(3);function h(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function v(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?h(n,!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):h(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var f=new(function(){function t(){var e=this;Object(l.a)(this,t),this._version=void 0,this._settings=void 0,this._drawing=void 0,this._canvasElm=void 0,this._cxt=void 0,this._scale=void 0,this._pan=void 0,this.selectedPoint=void 0,this.previewPoint=void 0,this._getPersistentSettings=function(){var t=localStorage.getItem("gc_settings");return t?JSON.parse(t):e._getInitialSettings()},this._readPersistentDrawing=function(){var t=localStorage.getItem("gc_current_drawing");return t?JSON.parse(t):{points:{"0,0,0":{x:0,y:0,z:0}}}},this._degrees_to_radians=function(t){return t*(Math.PI/180)},this._version="0.1.4",this._settings=this._getPersistentSettings(),this._drawing=this._readPersistentDrawing(),this._scale=1,this._pan={h:window.innerWidth/2,v:-window.innerHeight/2},this._cxt=null,this.selectedPoint=null,this.previewPoint=null}return Object(u.a)(t,[{key:"_getInitialSettings",value:function(){return{rotation:0,elevation:0,distance:1e3,picturePlane:1e3,offsetH:1754,offsetV:1240,docSize:{width:3508,height:2480}}}},{key:"_drawLine",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,a=this.project(t,n.start,e),r=this.project(t,n.end,e);this._cxt.strokeStyle=i,this._cxt.beginPath(),this._cxt.moveTo(a.h,this._canvasElm.height-a.v),this._cxt.lineTo(r.h,this._canvasElm.height-r.v),this._cxt.stroke()}},{key:"_drawGizmo",value:function(){var t=this;if(this._cxt){var e=v({},this._settings);e.distance=999999,e.picturePlane=999999;var n=function(n,i){t._cxt.strokeStyle=n,i.forEach((function(i){t._drawLine(e,!1,i,n)}))},i=[[{start:{x:0,y:0,z:0},end:{x:100,y:0,z:0}},{start:{x:80,y:0,z:3},end:{x:100,y:0,z:0}},{start:{x:80,y:0,z:-3},end:{x:100,y:0,z:0}},{start:{x:80,y:3,z:0},end:{x:100,y:0,z:0}},{start:{x:80,y:-3,z:0},end:{x:100,y:0,z:0}}],[{start:{x:0,y:0,z:0},end:{x:0,y:100,z:0}},{start:{x:3,y:80,z:0},end:{x:0,y:100,z:0}},{start:{x:-3,y:80,z:0},end:{x:0,y:100,z:0}},{start:{x:0,y:80,z:3},end:{x:0,y:100,z:0}},{start:{x:0,y:80,z:-3},end:{x:0,y:100,z:0}}],[{start:{x:0,y:0,z:0},end:{x:0,y:0,z:100}},{start:{x:3,y:0,z:80},end:{x:0,y:0,z:100}},{start:{x:-3,y:0,z:80},end:{x:0,y:0,z:100}},{start:{x:0,y:3,z:80},end:{x:0,y:0,z:100}},{start:{x:0,y:-3,z:80},end:{x:0,y:0,z:100}}]];n("#f00",i[0]),n("#0f0",i[1]),n("#00f",i[2])}}},{key:"project",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._settings,e=arguments.length>1?arguments[1]:void 0,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=this._degrees_to_radians(t.rotation),a=this._degrees_to_radians(t.elevation),r=e.x*Math.sin(i)+e.y*Math.cos(i),s=e.x*Math.cos(i)-e.y*Math.sin(i),o=r*Math.cos(a)-e.z*Math.sin(a),c=r*Math.sin(a)+e.z*Math.cos(a),l=t.picturePlane*s/(t.distance+o),u=t.picturePlane*c/(t.distance+o);return n?{h:l*this._scale+this._pan.h,v:u*this._scale-this._pan.v}:{h:l+this._pan.h,v:u-this._pan.v}}},{key:"addPointToDrawing",value:function(t,e){if(e)this._drawing.selectedPoint=t;else{if(void 0!==this._drawing.points[t.x+","+t.y+","+t.z])return null;this._drawing.points[t.x+","+t.y+","+t.z]=t}console.log(this._drawing),this.draw()}},{key:"deletePointFromDrawing",value:function(t){this._drawing.points[t]&&(delete this._drawing.points[t],this.draw())}},{key:"getSettings",value:function(){return this._settings}},{key:"setSettings",value:function(t){JSON.stringify(this._settings)!==JSON.stringify(t)&&(this._settings=t,localStorage.setItem("gc_settings",JSON.stringify(this._settings)),this.draw())}},{key:"setCanvasSize",value:function(){this._canvasElm&&this._canvasElm.getContext&&(this._canvasElm.width=window.innerWidth,this._canvasElm.height=window.innerHeight)}},{key:"getScale",value:function(){return this._scale}},{key:"setScale",value:function(t){this._scale=t,this.draw()}},{key:"pan",value:function(t,e){this._pan.h+=t/window.devicePixelRatio,this._pan.v+=e/window.devicePixelRatio}},{key:"registerCanvas",value:function(t){t&&t.getContext?(this._canvasElm=t,this._canvasElm.width=window.innerWidth,this._canvasElm.height=window.innerHeight,this._cxt=this._canvasElm.getContext("2d"),this._scale=1,console.log("version",this._version)):console.warn("Registered canvase element is not of type <canvas>!")}},{key:"draw",value:function(){var t=this;if(this._canvasElm&&this._cxt){this._canvasElm.width=window.innerWidth,this._canvasElm.height=window.innerHeight,this._cxt.fillStyle="rgb(231, 230, 227)",this._cxt.fillRect(0,0,this._canvasElm.width,this._canvasElm.height);var e=v({},this._settings);e.rotation=0,e.elevation=0,e.picturePlane=e.distance,this._cxt.fillStyle="rgb(245,245,245)";var n=this.project(e,{x:0,y:0,z:e.docSize.height}),i=this.project(e,{x:e.docSize.width,y:0,z:0});this._cxt.fillRect(n.h-e.offsetH*this._scale,this._canvasElm.height-n.v+e.offsetV*this._scale,i.h-n.h,n.v-i.v),this._cxt.strokeStyle="#aaa",[[{x:0,y:0,z:0},{x:e.docSize.width,y:0,z:0}],[{x:0,y:0,z:e.docSize.height},{x:e.docSize.width,y:0,z:e.docSize.height}],[{x:0,y:0,z:0},{x:0,y:0,z:this._settings.docSize.height}],[{x:e.docSize.width,y:0,z:0},{x:e.docSize.width,y:0,z:e.docSize.height}]].forEach((function(n){var i=t.project(e,n[0]),a=t.project(e,n[1]);t._cxt.beginPath(),t._cxt.moveTo(i.h-e.offsetH*t._scale,t._canvasElm.height-i.v+e.offsetV*t._scale),t._cxt.lineTo(a.h-e.offsetH*t._scale,t._canvasElm.height-a.v+e.offsetV*t._scale),t._cxt.stroke()})),this._drawGizmo(),this._cxt.strokeStyle="#aaa",this._cxt.beginPath();if([[{x:-100,y:-100,z:-100},{x:100,y:-100,z:-100}],[{x:-100,y:100,z:-100},{x:100,y:100,z:-100}],[{x:-100,y:-100,z:100},{x:100,y:-100,z:100}],[{x:-100,y:100,z:100},{x:100,y:100,z:100}],[{x:-100,y:-100,z:-100},{x:-100,y:-100,z:100}],[{x:100,y:-100,z:-100},{x:100,y:-100,z:100}],[{x:100,y:100,z:-100},{x:100,y:100,z:100}],[{x:-100,y:100,z:-100},{x:-100,y:100,z:100}],[{x:-100,y:-100,z:100},{x:-100,y:100,z:100}],[{x:100,y:-100,z:100},{x:100,y:100,z:100}],[{x:-100,y:-100,z:-100},{x:-100,y:100,z:-100}],[{x:100,y:-100,z:-100},{x:100,y:100,z:-100}]].forEach((function(e){t._drawLine(t._settings,!0,{start:e[0],end:e[1]},"#aaa")})),this._cxt.stroke(),this._drawing){for(var a in this._cxt.strokeStyle="#000",this._drawing.points){var r=this.project(this._settings,this._drawing.points[a]);this._cxt.beginPath(),this._cxt.arc(r.h,this._canvasElm.height-r.v,5,0,2*Math.PI),this._cxt.stroke()}if(this._cxt.strokeStyle="#d00",this.previewPoint){var s=this.project(this._settings,this.previewPoint);this._cxt.beginPath(),this._cxt.arc(s.h,this._canvasElm.height-s.v,5,0,2*Math.PI),this._cxt.stroke()}}}}},{key:"heightOfDrawing",get:function(){return this._canvasElm.clientHeight}},{key:"drawing",get:function(){return this._drawing}}]),t}()),d=function(t){var e=a.a.useRef(null);return a.a.useLayoutEffect((function(){var t=e.current;t&&f.registerCanvas(t)}),[]),a.a.createElement("canvas",{className:"canvas",ref:e,onClick:function(e){t.onClick(e)}})},g=function(t){var e=a.a.useRef(null),n=a.a.useState(t.value),i=Object(o.a)(n,2),r=i[0],s=i[1],c=t.returnValue;return a.a.useEffect((function(){c(r)}),[c,r]),a.a.createElement("label",null,t.label,":",a.a.createElement("input",{ref:e,type:"number",min:t.min,max:t.max,step:t.step,onChange:function(){return function(){var n=parseInt(""===e.current.value?"0":e.current.value);n<t.min?n=t.min:n>t.max&&(n=t.max),s(n)}()},value:r.toString()}))},p=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(l.a)(this,t),this._x=e,this._y=n,this._z=i,f.previewPoint={x:0,y:0,z:0},f.draw()}return Object(u.a)(t,[{key:"create",value:function(){f.addPointToDrawing({x:this._x,y:this._y,z:this._z})}},{key:"cleanUp",value:function(){f.previewPoint=null,f.draw()}},{key:"x",get:function(){return this._x},set:function(t){this._x=t,f.previewPoint&&(f.previewPoint.x=t),f.draw()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,f.previewPoint&&(f.previewPoint.y=t),f.draw()}},{key:"z",get:function(){return this._z},set:function(t){this._z=t,f.previewPoint&&(f.previewPoint.z=t),f.draw()}}]),t}(),y=function(t){var e=t.instance,n=t.killInstance;return a.a.createElement("div",{className:"dialog"},a.a.createElement("h2",null,"Add point"),a.a.createElement(g,{label:"X",value:e.x,min:-999,max:999,step:1,returnValue:function(t){e.x=t}}),a.a.createElement(g,{label:"Y",value:e.y,min:-999,max:999,step:1,returnValue:function(t){e.y=t}}),a.a.createElement(g,{label:"Z",value:e.z,min:-999,max:999,step:1,returnValue:function(t){e.z=t}}),a.a.createElement("button",{onClick:function(){e.create(),n()}},"Create"))};function w(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}var _=function(){function t(e){var n=this;Object(l.a)(this,t),this._selectedPointId=void 0,this.delete=function(){var t=n.getIdFromSelectedPoint();f.deletePointFromDrawing(t)},this.set=function(){if(f.previewPoint){var t=n.getIdFromSelectedPoint();if(f.drawing.points[t])return null;f.deletePointFromDrawing(n._selectedPointId),n._selectedPointId=t,f.addPointToDrawing({x:f.previewPoint.x,y:f.previewPoint.y,z:f.previewPoint.z}),f.draw()}},this.copy=function(){f.previewPoint&&(n._getPointFromDrawing(f.previewPoint.x,f.previewPoint.y,f.previewPoint.z)?console.warn("Point occupied!"):(f.addPointToDrawing({x:f.previewPoint.x,y:f.previewPoint.y,z:f.previewPoint.z}),f.draw()))},this.cleanUp=function(){f.previewPoint=null,f.draw()},e?(this._selectedPointId=e,f.previewPoint=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?w(n,!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):w(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},f.drawing.points[e])):(this._selectedPointId="0,0,0",f.previewPoint={x:0,y:0,z:0}),f.draw()}return Object(u.a)(t,[{key:"getIdFromSelectedPoint",value:function(){return f.previewPoint.x+","+f.previewPoint.y+","+f.previewPoint.z}},{key:"_getPointFromDrawing",value:function(t,e,n){var i=t+","+e+","+n;return f.drawing.points[i]?f.drawing.points[i]:null}},{key:"id",get:function(){return this._selectedPointId}},{key:"point",get:function(){return f.previewPoint}}],[{key:"pointIdAtPosition",value:function(t){var e=f.getSettings(),n="";return Object.keys(f.drawing.points).forEach((function(i){var a=f.drawing.points[i],r=f.project(e,a,!0),s=t.h-r.h,o=f.heightOfDrawing-t.v-r.v;Math.sqrt(s*s+o*o)<7&&(n=i)})),n}}]),t}(),x=function(t){var e=t.instance,n=t.killInstance;return f.draw(),a.a.createElement("div",{className:"dialog"},a.a.createElement("h2",null,"Selected Point"),a.a.createElement("button",{onClick:function(){e.delete(),n()}},"Delete"),a.a.createElement("button",{onClick:function(){return e.set()}},"Set"),a.a.createElement("button",{onClick:function(){return e.copy()}},"Copy"),a.a.createElement("div",null,a.a.createElement(g,{label:"X",min:-99999,max:99999,step:.01,value:e.point.x,returnValue:function(t){e.point.x=t,f.draw()}}),a.a.createElement(g,{label:"Y",min:-99999,max:99999,step:.01,value:e.point.y,returnValue:function(t){e.point.y=t,f.draw()}}),a.a.createElement(g,{label:"Z",min:-99999,max:99999,step:.01,value:e.point.z,returnValue:function(t){e.point.z=t,f.draw()}})))};function m(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}var P=function(){function t(){var e=this;Object(l.a)(this,t),this._settings=void 0,this.handleSettings=function(t,n){if(e._settings){var i=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?m(n,!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):m(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},e._settings);switch(t){case"rotation":i.rotation=n;break;case"elevation":i.elevation=n;break;case"distance":i.distance=n;break;case"picturePlane":i.picturePlane=n;break;case"offsetH":i.offsetH=n;break;case"offsetV":i.offsetV=n}f.setSettings(i),e._settings=i}},this._settings=f.getSettings()}return Object(u.a)(t,[{key:"settings",get:function(){return this._settings}}]),t}(),z=function(t){var e=t.instance;return a.a.createElement("div",{className:"dialog",onMouseDown:function(t){return t.stopPropagation()},onMouseMove:function(t){return t.stopPropagation()}},a.a.createElement("h2",null,"Perspektive Settings"),a.a.createElement(g,{label:"Rotation",min:0,max:359,step:5,value:e.settings.rotation,returnValue:function(t){return e.handleSettings("rotation",t)}}),a.a.createElement(g,{label:"Elevation",min:-90,max:90,step:5,value:e.settings.elevation,returnValue:function(t){return e.handleSettings("elevation",t)}}),a.a.createElement(g,{label:"Distance",min:0,max:999999,step:50,value:e.settings.distance,returnValue:function(t){return e.handleSettings("distance",t)}}),a.a.createElement(g,{label:"Distance to Picture Plane",min:0,max:999999,step:50,value:e.settings.picturePlane,returnValue:function(t){return e.handleSettings("picturePlane",t)}}),a.a.createElement(g,{label:"Offset Horisontal",min:0,max:999999,step:5,value:e.settings.offsetH,returnValue:function(t){return e.handleSettings("offsetH",t)}}),a.a.createElement(g,{label:"Offset Vertical",min:0,max:999999,step:5,value:e.settings.offsetV,returnValue:function(t){return e.handleSettings("offsetV",t)}}))},b=(n(13),function(){var t=a.a.useState(null),e=Object(o.a)(t,2),n=e[0],i=e[1],r=a.a.useState(null),s=Object(o.a)(r,2),c=s[0],l=s[1],u=a.a.useState(1),h=Object(o.a)(u,2),v=h[0],g=h[1];a.a.useEffect((function(){f.setScale(v)}),[v]),a.a.useEffect((function(){c&&f.pan(c.x,c.y),f.draw();var t=function(){f.setCanvasSize(),f.draw()};return window.addEventListener("resize",t),function(){window.removeEventListener("resize",t)}}),[c]);var w=a.a.useState([-1,-1]),m=Object(o.a)(w,2),b=m[0],E=m[1],O=a.a.useState([0,0]),S=Object(o.a)(O,2),k=S[0],j=S[1],D=a.a.useState(0),I=Object(o.a)(D,2),M=I[0],V=I[1],C=a.a.useState(0),H=Object(o.a)(C,2),Y=H[0],N=H[1];a.a.useEffect((function(){if(0!==M){var t=f.getScale()+.001*M;t<.2&&(t=.2),f.setScale(t)}else 0!==k[0]&&0!==k[1]&&f.pan(k[0]*window.devicePixelRatio,k[1]*window.devicePixelRatio),f.draw()}),[k,M]);var T=a.a.useState(null),X=Object(o.a)(T,2),R=X[0],F=X[1],J=a.a.useState(""),U=Object(o.a)(J,2),L=U[0],A=U[1],W=a.a.useState(null),q=Object(o.a)(W,2),B=q[0],G=q[1];return a.a.useEffect((function(){if(""!==L){var t=new _(L);G(t)}}),[L]),a.a.createElement("div",{className:"App",onMouseMove:function(t){var e;1===(e=t).buttons?l({x:e.movementX,y:e.movementY}):c&&l(null)},onWheel:function(t){return function(t){var e=v-5e-4*t.deltaY;e<.2&&(e=.2),g(e)}(t)},onTouchStart:function(t){!function(t){if(2===t.touches.length){var e=t.touches[1].clientX-t.touches[0].clientX,n=t.touches[1].clientY-t.touches[0].clientY,i=Math.sqrt(e*e+n*n);V(0),N(i)}1===t.touches.length&&E([t.touches[0].clientX,t.touches[0].clientY])}(t)},onTouchEnd:function(t){var e;1===(e=t).touches.length&&(V(0),N(0),E([e.touches[0].clientX,e.touches[0].clientY])),j([0,0])},onTouchMove:function(t){!function(t){if(t.touches.length>1){var e=t.touches[1].clientX-t.touches[0].clientX,n=t.touches[1].clientY-t.touches[0].clientY,i=Math.sqrt(e*e+n*n);V(i-Y),N(i)}else{var a=Math.ceil(t.touches[0].clientX-b[0]),r=Math.ceil(t.touches[0].clientY-b[1]);E([b[0]+a,b[1]+r]),j([a,r]),V(0),N(0)}}(t)}},a.a.createElement(d,{onClick:function(t){return e=t,i(null),F(null),B&&(B.cleanUp(),G(null)),void A(_.pointIdAtPosition({h:e.clientX,v:e.clientY}));var e}}),a.a.createElement("div",{className:"menu"},a.a.createElement("button",{onClick:function(t){t.preventDefault(),i(n?null:new P),F(null),B&&(B.cleanUp(),G(null))}},n?"Back":"Settings"),a.a.createElement("button",{onClick:function(){B&&(B.cleanUp(),G(null)),i(null),F(R?null:new p(0,0,0))}},"Add point")),n&&a.a.createElement(z,{instance:n,killInstance:function(){return i(null)}}),R&&a.a.createElement(y,{instance:R,killInstance:function(){R.cleanUp(),F(null)}}),B&&a.a.createElement(x,{instance:B,killInstance:function(){B.cleanUp(),G(null),A("")}}))});s.a.render(a.a.createElement(b,null),document.getElementById("root"))},7:function(t,e,n){t.exports=n(14)}},[[7,1,2]]]);
//# sourceMappingURL=main.32f16ea9.chunk.js.map